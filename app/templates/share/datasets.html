{% extends "base.html" %}
{% set active_page = "share.index" %}

{% block link %}
  {{ super() }}
  <link href="/static/css/share.css" rel="stylesheet">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/angular-ui/0.4.0/angular-ui.css">
  <link rel="stylesheet" href="/static/bower_components/jquery-ui/themes/smoothness/jquery-ui.css"/>
{% endblock %}

{% block head_ext %}
<style>
  input, select { 
    width: 100%;
  }
  .thumb {
    width: 24px;
    height: 24px;
    float: none;
    position: relative;
    top: 7px;
}

form .progress {
  line-height: 15px;
}


.progress {
    display: inline-block;
    width: 100px;
    border: 3px groove #CCC;
}

.progress div {
    font-size: smaller;
    background: orange;
    width: 0;
}
</style>

<!-- Flask template loads model_run_uuid into js var used in controllers.js -->
<script>
  var mrName = "{{ model_run_name }}";
  var mrDesc = "{{ model_run_desc }}";
  var mrUUID = "{{ model_run_uuid }}";
  var authToken = "{{ auth_token }}";
</script>
<script type="text/javascript" src="/static/bower_components/jquery/dist/jquery.min.js"></script>
<script type="text/javascript" src="/static/bower_components/jquery-ui/jquery-ui.min.js"></script>
<script src="/static/bower_components/angular/angular.min.js"></script>
<script src="/static/bower_components/angular-ui-date/src/date.js"></script>
<script src="/static/bower_components/ng-file-upload/ng-file-upload.min.js"></script>
<script src="/static/js/angular/controllers.js"></script>

{% endblock %}

{% block content %}

<!--<div ng-app="datasetShareApp">-->
  <!--<div ng-controller="DatasetShareCtrl">-->

    {% raw %}

    <div class="row">
      <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
        <h1>
          View or add files to resource
        </h1>
        <h2 style="text-align:center">
          <span>Resource Name:</span> <b>{{modelRunName}}</b>
        </h2>
        <h2 style="text-align:center">
          <span>Description:</span> <b>{{modelRunDescription}}</b>
        </h2>
        <h2 style="text-align:center">
          <span>Model Run UUID:</span> <b>{{modelRunUUID}}</b>
        </h2>
      </div>
    </div>
    
    <br> </br>

    <!--<h1>Sample using ng-file-upload</h1>-->
    
    <!--<form name="myForm">-->
      <!--<fieldset>-->
        <!--<legend>Upload on form submit</legend>-->
        <!--Username:-->
        <!--<input type="text" name="userName" ng-model="username" size="31" required="">-->
        <!--<i ng-show="myForm.userName.$error.required">*required</i>-->
        <!--<br> Photo:-->
        <!--<input type="file" ngf-select="" ng-model="picFile" name="file" -->
               <!--accept="image/*" ngf-max-size="2MB" required="">-->
        <!--<i ng-show="myForm.file.$error.required">*required</i>-->
        <!--<br>-->
        <!--<i ng-show="myForm.file.$error.maxSize">-->
          <!--File too large picFile.size / 1000000|number:1 MB: max 2M-->
        <!--</i>-->
        <!--<img class="thumb" src="" -->
             <!--alt="" ng-show="myForm.file.$valid" ngf-thumbnail="picFile">-->
        <!--<button ng-click="picFile = null" ng-show="picFile">Remove</button>-->
        <!--<br>-->
        
        <!--<button ng-disabled="!myForm.$valid" ng-click="uploadPic(picFile)">-->
          <!--Submit-->
        <!--</button>-->
        <!--<span class="progress" ng-show="picFile.progress >= 0">-->
          <!--<div style="width:{{picFile.progress}}%" ng-bind="picFile.progress + '%'">-->
          <!--</div>-->
        <!--</span>-->

        <!--<span ng-show="picFile.result">Upload Successful</span>-->
        <!--<span class="err" ng-show="errorMsg">{{errorMsg}}</span>-->
      <!--</fieldset>-->
    <!--</form>-->


    <h1>Upload new data</h1>
    <div class="container">
      <div style="background:#888;padding:0 0 60px;" class="col-md-8 col-md-offset-2">

      <form method="post" 
            name="uploadForm" enctype="multipart/form-data">
    
        <div class="col-md-6 col-md-offset-3">
          <h4>Select file to upload</h4>
          <input name="file" type="file" id="file" ngf-select="" 
                ng-model="file" required/>
        </div>
    
        <div class="col-md-6 col-md-offset-3">
          <h4>Model</h4>
          <select name="model" id="model" ng-model="modelName" required>
            <option value="" disabled selected>
              What model was the data originally for?
            </option>
            <option value="isnobal">iSNOBAL</option>
            <option value="prms">PRMS</option>
            <option value="HydroGeoSphere">CASiMiR</option>
            <option value="HydroGeoSphere">DFLOW</option>
            <option value="HydroGeoSphere">HydroGeoSphere</option>
            <option value="reference">reference</option>
          </select>
        </div>
    
        <div class="col-md-6 col-md-offset-3">
          <h4>Watershed</h4>
          <select name="watershed" id="watershed" ng-model="watershedName" 
              required>
            <option value="" disabled selected>Select your watershed...</option>
            <option value="Valles Caldera">Valles Caldera</option>
            <option value="Dry Creek">Dry Creek</option>
            <option value="Reynolds Creek">Reynolds Creek</option>
            <option value="Lehman Creek">Lehman Creek</option>
          </select>
        </div>
    
        <div class="col-md-10 col-md-offset-1">
          <h4>Description</h4>
          <input type="text" name="description" 
                 ng-model="description" id="description"
                 required/>
        </div>
        <!--<div class="col-md-12">-->
            <!--<div class="col-xs-6 col-sm-6 col-md-6 col-lg-6" -->

            <div class="row">
              <div ng-repeat="key_title in [['start','Start Date'], 
                                     ['end', 'End Date']]">
              
                <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6">
                <h4 class="attribute-label">{{ key_title[1] }}:</h4>
                  <div class="col-lg-5 col-md-5 col-sm-12 col-xs-12">
                    <input ui-date="dateOptions"
                        ng-model="dates[key_title[0]]" ui-date/> <!--<br>-->
                  </div>
                  <div class="col-lg-7 col-md-7 col-sm-12 col-xs-12">
                    <select id="" name="" ng-model="dates[key_title[0]].hours"
                        ng-options="hour for hour in hours">
                      <option value="" disabled selected>Hour (default=0)</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          <!--</div>-->
          <!--</div>-->

        <div class="col-md-6 col-md-offset-2">
          <h4>Model Set (inputs, outputs, or reference)</h4>
          <select id="model_set" name="model_set" ng-model="modelSet" required>
            <option value="" disabled selected>
              Are your data inputs, outputs, or "reference" data?
            </option>
            <option value="inputs">inputs</option>
            <option value="outputs">outputs</option>
            <option value="reference">reference</option>
          </select>
        </div>
        <br>
        <div class="col-md-10 col-md-offset-1">

          <button ng-disabled="uploadForm.$invalid"  
              style="font-size:1.2em;margin-top:20px;width:100%" class="btn btn-primary"
              ng-click="pushToGstor(file)">
              Upload
          </button>
        </div>
      </form>
      </div>
    </div>

    <button ng-click="testGstorLogin()" 
            class="btn btn-primary" type="button">
      Test Logging in to Gstor</button>
        
        <h1>Auth Result</h1>
        <pre>{{authResult}}</pre>
        <h1>Upload Status</h1>
        <pre>{{uploadStatus}}</pre>
        <h1>Push Status</h1>
        <pre>{{pushStatus}}</pre>
        <h1>Metadata Result</h1>
        <pre>{{metadataResult|json}}</pre>
    
    <h1>List of data in this resource</h1>
    {% endraw %}
    
    <div style="background:lightgrey">
      {% include "common/fileList.html" %}
    </div>
    
    </div>
    <!--</div>-->
    
  <!--</div>-->
{% endblock %}
